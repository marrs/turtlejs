<!DOCTYPE HTML>
<html>
    <head>
        <style>
        body ,
        .logo-script ,
        .logo-response {
            background: #222;
            color: white;
        }

        .logo {
            display: flex;
        }

        .cmd-history {
            list-style: none;
            padding-left: 0;
        }

        .cmd-history li {
            color: white;
        }
        </style>
    </head>
    <body>
        <select id="loader">
            <option></option>
            <option value="1.1.1a">Square (a)</option>
            <option value="1.1.1b">Square (b)</option>
            <option value="1.1.1c">Square [size]</option>
        </select>
        <div class="logo">
            <canvas id="canvas" width="800" height="800"></canvas>
            <div class="ui">
                <ul id="cmd-history" class="cmd-history">
                </ul>
                <textarea rows="20" id="logo-script" class="logo-script"></textarea>
                <p id="logo-response" class="logo-response"></p>
            </div>
        </div>
        <script src="turtle.js"></script>
        <script src="logo.js"></script>
        <script src="turtle-geometry.js"></script>
        <script>
            var tl = turtle(document.getElementById('canvas'));
            tl.clear();
            window.turtle = tl;
            var logo = Logo(tl);
            var txt = document.getElementById('logo-script');
            var elResponse = document.getElementById('logo-response');
            var cmdHistory = document.getElementById('cmd-history');
            var isToing = false;

            function eval_input(el) {
                var expr = el.value;
                var response = logo.eval(expr);
                if (response) {
                    elResponse.innerText = response;
                } else {
                    var li = document.createElement('li');
                    li.innerText = expr;
                    cmdHistory.append(li);
                    el.value = '';
                }
            }

            var indent_str = '  ';

            txt.addEventListener('keydown', function(evt) {
                switch (evt.key) {
                    case 'Enter': {
                        elResponse.innerText = '';
                        var expr = evt.target.value;
                        if (expr) {
                            evt.preventDefault();
                            if (isToing) {
                                if (/\n[ \t]+$/.test(expr)) {
                                    isToing = false;
                                    eval_input(evt.target);
                                } else {
                                    evt.target.value += '\n' + indent_str;
                                }
                            } else if (/^to/.test(expr)) {
                                isToing = true;
                                evt.target.value += '\n' + indent_str;
                            } else {
                                eval_input(evt.target);
                            }
                        }
                    } break;
                }
            });

            var loader = document.getElementById('loader');
            loader.addEventListener('change', function(evt) {
                txt.value = tg[evt.target.value];
                txt.focus();
            });
        </script>
    </body>
</html>
